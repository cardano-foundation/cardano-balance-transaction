{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"cardano-balance-tx","text":"<p>Standalone Cardano transaction balancing library.</p>"},{"location":"#what-it-does","title":"What it does","text":"<p><code>cardano-balance-tx</code> takes a partial Cardano transaction \u2014 one with user-specified outputs but incomplete inputs and fees \u2014 and produces a fully balanced, ready-to-sign transaction.</p> <p>The library handles coin selection, fee estimation, change construction, surplus distribution, token bundle size validation, Plutus redeemer assignment, and transaction size estimation across Babbage and Conway eras.</p> <pre><code>flowchart LR\n    A[\"Partial Tx\\n+ UTxO\\n+ Protocol Params\"] --&gt; B[\"balanceTx\"]\n    B --&gt; C[\"Balanced Tx\\n(ready to sign)\"]</code></pre>"},{"location":"#getting-started","title":"Getting started","text":"<p>See the Getting Started guide for build instructions and Nix setup.</p>"},{"location":"#documentation","title":"Documentation","text":"<ul> <li>Architecture \u2014 how the balancing pipeline works</li> <li>Module Reference \u2014 all exposed modules with descriptions</li> <li>Getting Started \u2014 build, test, and develop</li> </ul>"},{"location":"#links","title":"Links","text":"<ul> <li>GitHub Repository</li> <li>cardano-coin-selection \u2014 coin selection dependency</li> <li>cardano-wallet \u2014 origin project</li> </ul>"},{"location":"#license","title":"License","text":"<p>Apache-2.0 \u2014 Copyright 2018-2022 IOHK, 2023-2026 Cardano Foundation.</p>"},{"location":"architecture/","title":"Architecture","text":""},{"location":"architecture/#balancing-pipeline","title":"Balancing pipeline","text":"<p>Transaction balancing transforms a partial transaction (user-specified outputs, no inputs or fees) into a fully balanced transaction ready for signing. The core entry point is <code>balanceTx</code> in <code>Cardano.Balance.Tx.Balance</code>.</p>"},{"location":"architecture/#pipeline-stages","title":"Pipeline stages","text":"<pre><code>flowchart TD\n    A[\"Partial Tx + UTxO + Protocol Params\"] --&gt; B\n    B[\"1. Coin Selection\\n(CoinSelection)\"]\n    B -- \"inputs selected\" --&gt; C\n    C[\"2. Fee Estimation\\n(SizeEstimation)\"]\n    C -- \"fee computed\" --&gt; D\n    D[\"3. Change Outputs\\n(Surplus, TokenBundleSize)\"]\n    D -- \"change distributed\" --&gt; E\n    E[\"4. Redeemer Assignment\\n(Redeemers)\"]\n    E -- \"redeemers reindexed\" --&gt; F\n    F[\"5. Validation\"]\n    F --&gt; G[\"Balanced Tx (ready to sign)\"]</code></pre>"},{"location":"architecture/#iteration","title":"Iteration","text":"<p>The algorithm must iterate because adding inputs changes the transaction size and therefore the fee. Each iteration:</p> <ol> <li>Estimates the fee for the current transaction</li> <li>Runs coin selection if more inputs are needed</li> <li>Recomputes change outputs</li> <li>Checks if the fee has stabilized</li> </ol> <p>Convergence is guaranteed because each round can only add inputs (never remove them), and the UTxO set is finite.</p> <pre><code>flowchart TD\n    A[\"Estimate fee\"] --&gt; B[\"Run coin selection\"]\n    B --&gt; C[\"Recompute change outputs\"]\n    C --&gt; D{\"Fee stabilized?\"}\n    D -- \"No\" --&gt; A\n    D -- \"Yes\" --&gt; E[\"Proceed to validation\"]</code></pre>"},{"location":"architecture/#module-organization","title":"Module organization","text":"<p>The library is organized into three layers:</p>"},{"location":"architecture/#core-types","title":"Core types","text":"<ul> <li><code>Primitive</code> \u2014 lightweight value types (coin, token bundle,   address) inlined from <code>cardano-wallet-primitive</code>, bridging to ledger   types via <code>Primitive.Convert</code></li> <li><code>Tx</code> \u2014 transaction-level types, key witness counting</li> <li><code>TxWithUTxO</code> \u2014 a transaction paired with its resolved UTxO context</li> <li><code>Eras</code> \u2014 era definitions (<code>RecentEra</code> covering Babbage/Conway)</li> </ul>"},{"location":"architecture/#balancing-logic","title":"Balancing logic","text":"<ul> <li><code>Balance</code> \u2014 the main <code>balanceTx</code> function and error types</li> <li><code>Balance.CoinSelection</code> \u2014 adapter between ledger types and the   <code>cardano-coin-selection</code> library</li> <li><code>Balance.Surplus</code> \u2014 distributing fee surplus between padding and   change</li> <li><code>Balance.TokenBundleSize</code> \u2014 assessing whether token bundles fit   in a single output</li> </ul>"},{"location":"architecture/#utilities","title":"Utilities","text":"<ul> <li><code>SizeEstimation</code> \u2014 predicting serialized transaction size</li> <li><code>Redeemers</code> \u2014 assigning script redeemer indices</li> <li><code>Sign</code> \u2014 transaction signing</li> <li><code>TimeTranslation</code> \u2014 slot/time conversion from epoch info</li> <li><code>UTxOAssumptions</code> \u2014 assumptions about UTxO script types for size   estimation</li> </ul> <pre><code>graph TD\n    subgraph Core[\"Core types\"]\n        Primitive\n        Tx\n        TxWithUTxO\n        Eras\n    end\n    subgraph Balancing[\"Balancing logic\"]\n        Balance\n        CoinSelection[\"Balance.CoinSelection\"]\n        Surplus[\"Balance.Surplus\"]\n        TokenBundleSize[\"Balance.TokenBundleSize\"]\n    end\n    subgraph Utilities\n        SizeEstimation\n        Redeemers\n        Sign\n        TimeTranslation\n        UTxOAssumptions\n    end\n    Balance --&gt; CoinSelection\n    Balance --&gt; Surplus\n    Balance --&gt; TokenBundleSize\n    Balance --&gt; SizeEstimation\n    Balance --&gt; Redeemers\n    Balancing --&gt; Core\n    Utilities --&gt; Core</code></pre>"},{"location":"architecture/#era-support","title":"Era support","text":"<p>The library uses a <code>RecentEra</code> GADT to support Babbage and Conway. All era-specific logic is isolated in <code>Eras</code> and pattern-matched where needed, keeping the core balancing algorithm era-polymorphic.</p>"},{"location":"getting-started/","title":"Getting Started","text":""},{"location":"getting-started/#prerequisites","title":"Prerequisites","text":"<ul> <li>Nix with flakes enabled</li> <li>Or: GHC 9.12.2, cabal-install, and the Cardano Haskell package   repository (CHaP)</li> </ul>"},{"location":"getting-started/#building-with-nix-recommended","title":"Building with Nix (recommended)","text":"<pre><code># Clone the repository\ngit clone https://github.com/cardano-foundation/cardano-balance-transaction.git\ncd cardano-balance-transaction\n\n# Enter the development shell\nnix develop\n\n# Build the library\ncabal build lib:cardano-balance-tx -O0\n\n# Run the test suite\ncabal test unit -O0\n</code></pre>"},{"location":"getting-started/#building-without-nix","title":"Building without Nix","text":"<p>You need GHC 9.12.2 and access to CHaP. Add to your <code>cabal.project</code> (or use the one in this repository):</p> <pre><code>repository cardano-haskell-packages\n  url: https://chap.intersectmbo.org/\n  secure: True\n</code></pre> <p>Then:</p> <pre><code>cabal update\ncabal build lib:cardano-balance-tx -O0\ncabal test unit -O0\n</code></pre>"},{"location":"getting-started/#test-suite","title":"Test suite","text":"<p>The test suite contains 268 property tests and golden tests ported from <code>cardano-wallet</code>. Run with:</p> <pre><code>cabal test unit -O0\n</code></pre> <p>To run with verbose output:</p> <pre><code>cabal test unit -O0 --test-show-details=direct\n</code></pre>"},{"location":"getting-started/#documentation-site","title":"Documentation site","text":"<p>Build the MkDocs documentation locally:</p> <pre><code>nix develop\nmkdocs serve\n</code></pre> <p>Then open http://127.0.0.1:8000.</p>"},{"location":"modules/","title":"Module Reference","text":""},{"location":"modules/#balancing","title":"Balancing","text":""},{"location":"modules/#cardanobalancetxbalance","title":"<code>Cardano.Balance.Tx.Balance</code>","text":"<p>Main entry point. Exports <code>balanceTx</code> and all error types (<code>ErrBalanceTx</code>, <code>ErrBalanceTxAssetsInsufficientError</code>, etc.).</p>"},{"location":"modules/#cardanobalancetxbalancecoinselection","title":"<code>Cardano.Balance.Tx.Balance.CoinSelection</code>","text":"<p>Adapter bridging ledger types to the <code>cardano-coin-selection</code> library. Converts between ledger UTxO/coin representations and the types expected by the coin selection algorithm.</p>"},{"location":"modules/#cardanobalancetxbalancesurplus","title":"<code>Cardano.Balance.Tx.Balance.Surplus</code>","text":"<p>Surplus distribution logic. Given excess ada after fee estimation, decides how to split it between fee padding and change outputs. Exports <code>distributeSurplus</code>, <code>sizeOfCoin</code>, <code>costOfIncreasingCoin</code>.</p>"},{"location":"modules/#cardanobalancetxbalancetokenbundlesize","title":"<code>Cardano.Balance.Tx.Balance.TokenBundleSize</code>","text":"<p>Assesses whether a token bundle fits within the maximum serialized length allowed by the ledger. Exports <code>TokenBundleSizeAssessor</code>, <code>mkTokenBundleSizeAssessor</code>.</p>"},{"location":"modules/#types","title":"Types","text":""},{"location":"modules/#cardanobalancetxeras","title":"<code>Cardano.Balance.Tx.Eras</code>","text":"<p>Era definitions. The <code>RecentEra</code> GADT covers Babbage and Conway, with associated type families and constraints.</p>"},{"location":"modules/#cardanobalancetxprimitive","title":"<code>Cardano.Balance.Tx.Primitive</code>","text":"<p>Lightweight primitive types for transaction balancing, inlined from <code>cardano-wallet-primitive</code>. Intended to be imported qualified as <code>W</code>.</p>"},{"location":"modules/#cardanobalancetxprimitiveconvert","title":"<code>Cardano.Balance.Tx.Primitive.Convert</code>","text":"<p>Conversions between primitive types and ledger types. Replaces <code>Cardano.Wallet.Primitive.Ledger.Convert</code>. Exports <code>toLedgerCoin</code>, <code>fromLedgerCoin</code>, <code>toLedgerTokenBundle</code>, <code>fromLedgerTokenBundle</code>.</p>"},{"location":"modules/#cardanobalancetxtx","title":"<code>Cardano.Balance.Tx.Tx</code>","text":"<p>Transaction-level types: <code>KeyWitnessCounts</code>, partial transaction construction, and serialization utilities. Covers both Babbage and Conway representations.</p>"},{"location":"modules/#cardanobalancetxtxwithutxo","title":"<code>Cardano.Balance.Tx.TxWithUTxO</code>","text":"<p>The <code>TxWithUTxO</code> data type \u2014 a transaction bundled with the UTxO entries it references. Provides smart constructors <code>construct</code> and <code>constructFiltered</code>.</p>"},{"location":"modules/#utilities","title":"Utilities","text":""},{"location":"modules/#cardanobalancetxredeemers","title":"<code>Cardano.Balance.Tx.Redeemers</code>","text":"<p>Plutus redeemer index assignment. After coin selection changes the input set, redeemer indices must be updated to match the new ordering.</p>"},{"location":"modules/#cardanobalancetxsign","title":"<code>Cardano.Balance.Tx.Sign</code>","text":"<p>Transaction signing utilities for the balancing process.</p>"},{"location":"modules/#cardanobalancetxsizeestimation","title":"<code>Cardano.Balance.Tx.SizeEstimation</code>","text":"<p>Transaction size and cost estimation. Predicts the serialized byte size of a transaction before final encoding, used to estimate fees. Exports <code>estimateTxSize</code>, <code>estimateTxCost</code>.</p>"},{"location":"modules/#cardanobalancetxtimetranslation","title":"<code>Cardano.Balance.Tx.TimeTranslation</code>","text":"<p>Slot/time translation from epoch info. Provides <code>TimeTranslation</code> and <code>timeTranslationFromEpochInfo</code>.</p>"},{"location":"modules/#cardanobalancetxutxoassumptions","title":"<code>Cardano.Balance.Tx.UTxOAssumptions</code>","text":"<p>UTxO script assumptions for size estimation. Defines what script types are expected for UTxO entries when estimating witness sizes.</p>"},{"location":"modules/#testing","title":"Testing","text":""},{"location":"modules/#cardanobalancetxgen","title":"<code>Cardano.Balance.Tx.Gen</code>","text":"<p>QuickCheck generators for protocol parameters and datum hashes.</p>"},{"location":"modules/#cardanobalancetxprimitivegen","title":"<code>Cardano.Balance.Tx.Primitive.Gen</code>","text":"<p>QuickCheck generators for primitive types (<code>Coin</code>, <code>TokenBundle</code>, etc.) with distributions matching the original wallet test suite.</p>"},{"location":"modules/#cardanobalancetxtxwithutxogen","title":"<code>Cardano.Balance.Tx.TxWithUTxO.Gen</code>","text":"<p>Generators and shrinkers for <code>TxWithUTxO</code>, including variants with minimal and surplus UTxO.</p>"}]}